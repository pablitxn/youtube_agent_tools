services:
  # MinIO - Object Storage (S3-compatible)
  minio:
    image: minio/minio:latest
    container_name: youtube-rag-minio
    ports:
      - "9000:9000"
      - "9001:9001"
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: minioadmin
    volumes:
      - minio_data:/data
    command: server /data --console-address ":9001"
    healthcheck:
      test: ["CMD", "mc", "ready", "local"]
      interval: 5s
      timeout: 5s
      retries: 5

  # Qdrant - Vector Database
  qdrant:
    image: qdrant/qdrant:latest
    container_name: youtube-rag-qdrant
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - qdrant_data:/qdrant/storage
    environment:
      QDRANT__LOG_LEVEL: INFO

  # MongoDB - Document Database
  mongodb:
    image: mongo:7
    container_name: youtube-rag-mongodb
    ports:
      - "27017:27017"
    environment:
      MONGO_INITDB_ROOT_USERNAME: admin
      MONGO_INITDB_ROOT_PASSWORD: password
      MONGO_INITDB_DATABASE: youtube_rag
    volumes:
      - mongodb_data:/data/db
    healthcheck:
      test: ["CMD", "mongosh", "--eval", "db.adminCommand('ping')"]
      interval: 5s
      timeout: 5s
      retries: 5

  # Application (optional - for full stack deployment)
  # app:
  #   build: .
  #   container_name: youtube-rag-app
  #   ports:
  #     - "8000:8000"
  #   environment:
  #     YOUTUBE_RAG__APP__ENVIRONMENT: dev
  #     YOUTUBE_RAG__BLOB_STORAGE__ENDPOINT: minio:9000
  #     YOUTUBE_RAG__BLOB_STORAGE__ACCESS_KEY: minioadmin
  #     YOUTUBE_RAG__BLOB_STORAGE__SECRET_KEY: minioadmin
  #     YOUTUBE_RAG__VECTOR_DB__HOST: qdrant
  #     YOUTUBE_RAG__DOCUMENT_DB__HOST: mongodb
  #     YOUTUBE_RAG__DOCUMENT_DB__USERNAME: admin
  #     YOUTUBE_RAG__DOCUMENT_DB__PASSWORD: password
  #   depends_on:
  #     minio:
  #       condition: service_healthy
  #     qdrant:
  #       condition: service_started
  #     mongodb:
  #       condition: service_healthy
  #   volumes:
  #     - ./config:/app/config:ro

volumes:
  minio_data:
  qdrant_data:
  mongodb_data:
